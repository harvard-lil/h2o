{% load call_method %}



<section class="{{ node.type }} {{ node.resource_type | lower }} depth-{{ node.ordinals | length }}">

  {% if node.resource_type == 'Link' %}
  <div class="link-icon"></div>
  {% endif %}

  <div class="node-container">

    {% if node.type == 'section' %}

      <div class="ordinal" data-toc-idx="{{ index }}">{{ node.ordinal_string }}

      <h4 class="title" >{{ node.title }}</h4>

      {% if node.subtitle %}
        <h5 class="subtitle">{{ node.subtitle }}</h5>
      {% endif %}

      {% if node.headnote %}
        {% call_method node 'headnote_for_export' export_options=export_options as headnote %}
        <section class="headnote" data-custom-style="Section Headnote">{{ headnote }}</section>
      {% endif %}

    {% elif node.type == 'resource' %}

      <div class="resource ordinal" data-toc-idx="{{ index }}">{{ node.ordinal_string }}.
        {% if node.resource_type == 'Link' %}
        Hyperlink to a web resource
        {% endif %}
      </div>

      <h4 class="resource title" >{{ node.title }}</h4>

      {% if node.subtitle %}
        <h5 class="subtitle">{{ node.subtitle }}</h5>
      {% endif %}

      {# I think the headnote should go below a link, but above a resource which is why this block prints headnotes#}
      {% if node.resource_type == 'Link' %}

      <div class="link-container">
        <a href="{{ node.resource.url }}" target="_blank">{{ node.resource.url }}</a>
      </div>

      {% if node.headnote %}
        <section class="headnote">{{ node.headnote_for_export }}</section>
      {% endif %}

    {% elif node.is_resource %}  {# case or textblock #}

      {# Duplicated in the link block because headnotes should go below a link but above cases and text blocks #}
      {% if node.headnote %}
        <section class="headnote">{{ node.headnote_for_export }}</section>
      {% endif %}

      <section class="resource">

        {% if include_annotations %}
          {% call_method node 'annotated_content_for_export' export_options=export_options as contents %}

          {{ contents }}

          {% call_method node 'footnote_annotations' export_options=export_options as footnote_contents %}
          <div class="footnote">{{ footnote_contents }}</div>
        {% else %}

        {% call_method node 'content_for_export' export_options=export_options as contents %}
        {{ contents }}

        {% endif %}
      </section>
    {% endif %}
  {% endif %}
  </div>
  </section>

{% if not is_child %}
  {% include 'export/as_printable_html/credits.html' %}
{% endif %}


