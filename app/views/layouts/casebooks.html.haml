- if @casebook.nil?
  - @casebook_class = 'casebook-none'
- elsif @casebook.public? || @preview
  - @casebook_class = 'casebook-public'
- else
  - @casebook_class = 'casebook-draft'
- if @casebook_class == 'casebook-draft'
  - content_for :banner do
    %div{:class => "#{@casebook_class} banner"}
      .banner-inner
        = t 'content.edit.draft-banner.html', publish_path: edit_casebook_path(@casebook)
- elsif @preview
  - content_for :banner do
    .casebook-preview.banner
      .banner-inner
        = t 'content.edit.preview-banner.html', edit_path: layout_casebook_path(@casebook)
- content_for :nested_layout do
  %header{:class => "#{@casebook_class} casebook", "data-casebook-id" => "#{@casebook.try(:id)}", "data-editable" => "#{@editable || ''}", "data-resource-id" => "#{@resource.try(:id)}", "data-section-id" => "#{@section.try(:id)}"}
    .content
      .casebook-inner
        = render 'content/search'
        - if @casebook.present?
          .tabs
            = render 'content/tabs'
        - else
  %section{:class => "#{@casebook_class} casebook"}
    .content
      .casebook-inner
        .top-strip
        = yield
      - if @casebook.present?
        %aside.casebook-actions
          = render 'content/actions'
  - if @casebook
    :javascript
      window.RAILS_ROUTES = {};
      RAILS_ROUTES.casebook_path = function (){ return '#{j casebook_path(@casebook)}'};
      RAILS_ROUTES.section_path = function (sectionId){ return '#{j section_path(@casebook, '$CHAPTER_ID$')}'.replace('$CHAPTER_ID$', sectionId)};
  - if @section.try(:is_a?, Content::Resource) && @section.persisted?
    :javascript
      window.RAILS_ROUTES = {};
      RAILS_ROUTES.resource_annotations_path = function () { return '#{j resource_annotations_path(@section.id)}' };
      RAILS_ROUTES.resource_annotation_path = function (id) { return '#{j resource_annotation_path(@section.id, '$ID')}'.replace('$ID', id) };
= render template: 'layouts/main'
