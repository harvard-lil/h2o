/*
** Annotator v2.0.0-dev.2-e021ea8
** https://github.com/okfn/annotator/
**
** Copyright 2014, the Annotator project contributors.
** Dual licensed under the MIT and GPLv3 licenses.
** https://github.com/okfn/annotator/blob/master/LICENSE
**
** Built at: 2014-04-29 20:06:43Z
*/
!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self);var o=n;o=o.Annotator||(o.Annotator={}),o=o.Plugin||(o.Plugin={}),o.Store=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"apYPS1":[function(_dereq_,module,exports){
(function (global){
var Annotator, self, _ref;

if (typeof self !== "undefined" && self !== null) {
  self = self;
}

if (typeof global !== "undefined" && global !== null) {
  if (self == null) {
    self = global;
  }
}

if (typeof window !== "undefined" && window !== null) {
  if (self == null) {
    self = window;
  }
}

Annotator = self != null ? self.Annotator : void 0;

if (Annotator == null) {
  Annotator = (self != null ? (_ref = self.define) != null ? _ref.amd : void 0 : void 0) ? self != null ? self.require('annotator') : void 0 : void 0;
}

if (typeof Annotator !== 'function') {
  throw new Error("Could not find Annotator! In a webpage context, please ensure that the Annotator script tag is loaded before any plugins.");
}

module.exports = Annotator;


}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],"annotator":[function(_dereq_,module,exports){
module.exports=_dereq_('apYPS1');
},{}],3:[function(_dereq_,module,exports){
var $, Annotator, Store, Util, _t;

Annotator = _dereq_('annotator');

Util = Annotator.Util;

$ = Util.$;

_t = Util.TranslationString;

Store = (function() {
  Store.prototype.options = {
    annotationData: null,
    emulateHTTP: false,
    emulateJSON: false,
    headers: {},
    prefix: '/store',
    urls: {
      create: '/annotations',
      read: '/annotations/:id',
      update: '/annotations/:id',
      destroy: '/annotations/:id',
      search: '/search'
    }
  };

  function Store(options) {
    if (arguments.length > 1) {
      options = arguments[1];
    }
    this.options = $.extend(true, {}, this.options, options);
    if (this.options.loadFromSearch) {
      Util.deprecationWarning("Use of the loadFromSearch option to the Store plugin is deprecated. Please call .load(queryObj) on the Annotator instance instead.");
    }
  }

  Store.prototype.pluginInit = function() {
    this.annotator.store = this;
    if (this.options.loadFromSearch) {
      return this.annotator.load(this.options.loadFromSearch);
    }
  };

  Store.prototype.create = function(annotation) {
    return this._apiRequest('create', annotation);
  };

  Store.prototype.update = function(annotation) {
    return this._apiRequest('update', annotation);
  };

  Store.prototype["delete"] = function(annotation) {
    return this._apiRequest('destroy', annotation);
  };

  Store.prototype.query = function(queryObj) {
    var dfd;
    dfd = $.Deferred();
    this._apiRequest('search', queryObj).done(function(obj) {
      var rows;
      rows = obj.rows;
      delete obj.rows;
      return dfd.resolve(rows, obj);
    }).fail(function() {
      return dfd.reject.apply(dfd, arguments);
    });
    return dfd.promise();
  };

  Store.prototype.setHeader = function(key, value) {
    return this.options.headers[key] = value;
  };

  Store.prototype._apiRequest = function(action, obj) {
    var id, options, request, url;
    id = obj && obj.id;
    url = this._urlFor(action, id);
    options = this._apiRequestOptions(action, obj);
    request = $.ajax(url, options);
    request._id = id;
    request._action = action;
    return request;
  };

  Store.prototype._apiRequestOptions = function(action, obj) {
    var data, method, opts;
    method = this._methodFor(action);
    opts = {
      type: method,
      dataType: "json",
      error: this._onError,
      headers: this.options.headers
    };
    if (this.options.emulateHTTP && (method === 'PUT' || method === 'DELETE')) {
      opts.headers = $.extend(opts.headers, {
        'X-HTTP-Method-Override': method
      });
      opts.type = 'POST';
    }
    if (action === "search") {
      opts = $.extend(opts, {
        data: obj
      });
      return opts;
    }
    if (this.options.annotationData != null) {
      Util.deprecationWarning("Use of the annotationData option to the Store plugin is deprecated and will be removed in a future version. Please use hooks to beforeAnnotationCreated and beforeAnnotationUpdated to replicate this behaviour.");
      $.extend(obj, this.options.annotationData);
    }
    data = obj && JSON.stringify(obj);
    if (this.options.emulateJSON) {
      opts.data = {
        json: data
      };
      if (this.options.emulateHTTP) {
        opts.data._method = method;
      }
      return opts;
    }
    opts = $.extend(opts, {
      data: data,
      contentType: "application/json; charset=utf-8"
    });
    return opts;
  };

  Store.prototype._urlFor = function(action, id) {
    var url;
    url = this.options.prefix != null ? this.options.prefix : '';
    url += this.options.urls[action];
    url = url.replace(/\/:id/, id != null ? '/' + id : '');
    url = url.replace(/:id/, id != null ? id : '');
    return url;
  };

  Store.prototype._methodFor = function(action) {
    var table;
    table = {
      create: 'POST',
      read: 'GET',
      update: 'PUT',
      destroy: 'DELETE',
      search: 'GET'
    };
    return table[action];
  };

  Store.prototype._onError = function(xhr) {
    var action, message;
    action = xhr._action;
    message = _t("Sorry we could not ") + action + _t(" this annotation");
    if (xhr._action === 'search') {
      message = _t("Sorry we could not search the store for annotations");
    } else if (xhr._action === 'read' && !xhr._id) {
      message = _t("Sorry we could not ") + action + _t(" the annotations from the store");
    }
    switch (xhr.status) {
      case 401:
        message = _t("Sorry you are not allowed to ") + action + _t(" this annotation");
        break;
      case 404:
        message = _t("Sorry we could not connect to the annotations store");
        break;
      case 500:
        message = _t("Sorry something went wrong with the annotation store");
    }
    Annotator.showNotification(message, Annotator.Notification.ERROR);
    return console.error(_t("API request failed:") + (" '" + xhr.status + "'"));
  };

  return Store;

})();

Annotator.Plugin.register('Store', Store);

module.exports = Store;


},{}]},{},[3])

(3)
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGtnL2Fubm90YXRvci5zdG9yZS5qcyIsInNvdXJjZXMiOlsiLi4vbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIm5hbWVzcGFjZS5jb2ZmZWUiLCJwbHVnaW4vc3RvcmUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtBQ0tBOztBQUFBO0FBQUEsU0FBTyxJQUFQO0NBQUE7O0FBQ0E7O0lBQUEsT0FBUTtHQUFSO0NBREE7O0FBRUE7O0lBQUEsT0FBUTtHQUFSO0NBRkE7O0FBQUE7OztFQU1BLHNCQUFhO0NBTmI7O0FBVUE7QUFDRSxRQUFVLFVBQU0sb0JBRGxCO0NBVkE7O0FBQUE7Ozs7Ozs7O0FDTEE7O0FBQUEsWUFBWSxRQUFRLFdBQVIsQ0FBWjs7QUFBQSxJQUNBLEdBQU8sU0FBUyxDQUFDLElBRGpCOztBQUFBLENBRUEsR0FBSSxJQUFJLENBQUMsQ0FGVDs7QUFBQSxFQUdBLEdBQUssSUFBSSxDQUFDLGlCQUhWOztBQUFBO0FBa0JFLDRCQU1FO0FBQUEsb0JBQWdCLElBQWhCO0FBQUEsSUFPQSxhQUFhLEtBUGI7QUFBQSxJQVdBLGFBQWEsS0FYYjtBQUFBLElBZUEsU0FBUyxFQWZUO0FBQUEsSUFtQkEsUUFBUSxRQW5CUjtBQUFBLElBOEJBLE1BQ0U7QUFBQSxjQUFRLGNBQVI7QUFBQSxNQUNBLE1BQU0sa0JBRE47QUFBQSxNQUVBLFFBQVEsa0JBRlI7QUFBQSxNQUdBLFNBQVMsa0JBSFQ7QUFBQSxNQUlBLFFBQVEsU0FKUjtLQS9CRjtHQU5GOztBQTJEYSxpQkFBQyxPQUFEO0FBSVgsUUFBRyxTQUFTLENBQUMsTUFBVixHQUFtQixDQUF0QjtBQUNFLGdCQUFVLFNBQVUsR0FBcEIsQ0FERjtLQUFBO0FBQUEsSUFHQSxJQUFDLFFBQUQsR0FBVyxDQUFDLENBQUMsTUFBRixDQUFTLElBQVQsRUFBZSxFQUFmLEVBQW1CLElBQUMsUUFBcEIsRUFBNkIsT0FBN0IsQ0FIWDtBQUtBLFFBQUcsSUFBQyxRQUFPLENBQUMsY0FBWjtBQUNFLFVBQUksQ0FBQyxrQkFBTCxDQUF3QixvSUFBeEIsRUFERjtLQVRXO0VBQUEsQ0EzRGI7O0FBQUEsa0JBMkVBLGFBQVk7QUFDVixRQUFDLFVBQVMsQ0FBQyxLQUFYLEdBQW1CLElBQW5CO0FBQ0EsUUFBRyxJQUFDLFFBQU8sQ0FBQyxjQUFaO2FBQ0UsSUFBQyxVQUFTLENBQUMsSUFBWCxDQUFnQixJQUFDLFFBQU8sQ0FBQyxjQUF6QixFQURGO0tBRlU7RUFBQSxDQTNFWjs7QUFBQSxrQkE0RkEsU0FBUSxTQUFDLFVBQUQ7V0FDTixJQUFJLENBQUMsV0FBTCxDQUFpQixRQUFqQixFQUEyQixVQUEzQixFQURNO0VBQUEsQ0E1RlI7O0FBQUEsa0JBMkdBLFNBQVEsU0FBQyxVQUFEO1dBQ04sSUFBSSxDQUFDLFdBQUwsQ0FBaUIsUUFBakIsRUFBMkIsVUFBM0IsRUFETTtFQUFBLENBM0dSOztBQUFBLGtCQTBIQSxZQUFRLFNBQUMsVUFBRDtXQUNOLElBQUksQ0FBQyxXQUFMLENBQWlCLFNBQWpCLEVBQTRCLFVBQTVCLEVBRE07RUFBQSxDQTFIUjs7QUFBQSxrQkFnSUEsUUFBTyxTQUFDLFFBQUQ7QUFDTDtBQUFBLFVBQU0sQ0FBQyxDQUFDLFFBQUYsRUFBTjtBQUFBLElBQ0EsSUFBSSxDQUFDLFdBQUwsQ0FBaUIsUUFBakIsRUFBMkIsUUFBM0IsQ0FDQSxDQUFDLElBREQsQ0FDTSxTQUFDLEdBQUQ7QUFDSjtBQUFBLGFBQU8sR0FBRyxDQUFDLElBQVg7QUFBQSxNQUNBLFVBQVUsQ0FBQyxJQURYO2FBRUEsR0FBRyxDQUFDLE9BQUosQ0FBWSxJQUFaLEVBQWtCLEdBQWxCLEVBSEk7SUFBQSxDQUROLENBS0EsQ0FBQyxJQUxELENBS007YUFDSixHQUFHLENBQUMsTUFBTSxDQUFDLEtBQVgsQ0FBaUIsR0FBakIsRUFBc0IsU0FBdEIsRUFESTtJQUFBLENBTE4sQ0FEQTtBQVFBLFdBQU8sR0FBRyxDQUFDLE9BQUosRUFBUCxDQVRLO0VBQUEsQ0FoSVA7O0FBQUEsa0JBcUpBLFlBQVcsU0FBQyxHQUFELEVBQU0sS0FBTjtXQUNULElBQUksQ0FBQyxPQUFPLENBQUMsT0FBUSxLQUFyQixHQUE0QixNQURuQjtFQUFBLENBckpYOztBQUFBLGtCQXlLQSxjQUFhLFNBQUMsTUFBRCxFQUFTLEdBQVQ7QUFDWDtBQUFBLFNBQUssT0FBTyxHQUFHLENBQUMsRUFBaEI7QUFBQSxJQUNBLE1BQU0sSUFBSSxDQUFDLE9BQUwsQ0FBYSxNQUFiLEVBQXFCLEVBQXJCLENBRE47QUFBQSxJQUVBLFVBQVUsSUFBSSxDQUFDLGtCQUFMLENBQXdCLE1BQXhCLEVBQWdDLEdBQWhDLENBRlY7QUFBQSxJQUlBLFVBQVUsQ0FBQyxDQUFDLElBQUYsQ0FBTyxHQUFQLEVBQVksT0FBWixDQUpWO0FBQUEsSUFRQSxPQUFPLENBQUMsR0FBUixHQUFjLEVBUmQ7QUFBQSxJQVNBLE9BQU8sQ0FBQyxPQUFSLEdBQWtCLE1BVGxCO1dBVUEsUUFYVztFQUFBLENBektiOztBQUFBLGtCQTZMQSxxQkFBb0IsU0FBQyxNQUFELEVBQVMsR0FBVDtBQUNsQjtBQUFBLGFBQVMsSUFBSSxDQUFDLFVBQUwsQ0FBZ0IsTUFBaEIsQ0FBVDtBQUFBLElBRUEsT0FDRTtBQUFBLFlBQU0sTUFBTjtBQUFBLE1BQ0EsVUFBVSxNQURWO0FBQUEsTUFFQSxPQUFPLElBQUksQ0FBQyxRQUZaO0FBQUEsTUFHQSxTQUFTLElBQUksQ0FBQyxPQUFPLENBQUMsT0FIdEI7S0FIRjtBQVVBLFFBQUcsSUFBQyxRQUFPLENBQUMsV0FBVCxJQUF5QixZQUFXLEtBQVgsZUFBa0IsUUFBbEIsQ0FBNUI7QUFDRSxVQUFJLENBQUMsT0FBTCxHQUFlLENBQUMsQ0FBQyxNQUFGLENBQVMsSUFBSSxDQUFDLE9BQWQsRUFBdUI7QUFBQSxRQUFDLDBCQUEwQixNQUEzQjtPQUF2QixDQUFmO0FBQUEsTUFDQSxJQUFJLENBQUMsSUFBTCxHQUFZLE1BRFosQ0FERjtLQVZBO0FBZUEsUUFBRyxXQUFVLFFBQWI7QUFDRSxhQUFPLENBQUMsQ0FBQyxNQUFGLENBQVMsSUFBVCxFQUFlO0FBQUEsY0FBTSxHQUFOO09BQWYsQ0FBUDtBQUNBLGFBQU8sSUFBUCxDQUZGO0tBZkE7QUFzQkEsUUFBRyxtQ0FBSDtBQUNFLFVBQUksQ0FBQyxrQkFBTCxDQUF3QixrTkFBeEI7QUFBQSxNQU1BLENBQUMsQ0FBQyxNQUFGLENBQVMsR0FBVCxFQUFjLElBQUMsUUFBTyxDQUFDLGNBQXZCLENBTkEsQ0FERjtLQXRCQTtBQUFBLElBK0JBLE9BQU8sT0FBTyxJQUFJLENBQUMsU0FBTCxDQUFlLEdBQWYsQ0EvQmQ7QUFvQ0EsUUFBRyxJQUFDLFFBQU8sQ0FBQyxXQUFaO0FBQ0UsVUFBSSxDQUFDLElBQUwsR0FBWTtBQUFBLFFBQUMsTUFBTSxJQUFQO09BQVo7QUFDQSxVQUFHLElBQUMsUUFBTyxDQUFDLFdBQVo7QUFDRSxZQUFJLENBQUMsSUFBSSxDQUFDLE9BQVYsR0FBb0IsTUFBcEIsQ0FERjtPQURBO0FBR0EsYUFBTyxJQUFQLENBSkY7S0FwQ0E7QUFBQSxJQTBDQSxPQUFPLENBQUMsQ0FBQyxNQUFGLENBQVMsSUFBVCxFQUFlO0FBQUEsTUFDcEIsTUFBTSxJQURjO0FBQUEsTUFFcEIsYUFBYSxpQ0FGTztLQUFmLENBMUNQO0FBOENBLFdBQU8sSUFBUCxDQS9Da0I7RUFBQSxDQTdMcEI7O0FBQUEsa0JBNFBBLFVBQVMsU0FBQyxNQUFELEVBQVMsRUFBVDtBQUNQO0FBQUEsVUFBUywyQkFBSCxHQUF5QixJQUFDLFFBQU8sQ0FBQyxNQUFsQyxHQUE4QyxFQUFwRDtBQUFBLElBQ0EsT0FBTyxJQUFDLFFBQU8sQ0FBQyxJQUFLLFFBRHJCO0FBQUEsSUFJQSxNQUFNLEdBQUcsQ0FBQyxPQUFKLENBQVksT0FBWixFQUF3QixVQUFILEdBQVksTUFBTSxFQUFsQixHQUEwQixFQUEvQyxDQUpOO0FBQUEsSUFNQSxNQUFNLEdBQUcsQ0FBQyxPQUFKLENBQVksS0FBWixFQUFzQixVQUFILEdBQVksRUFBWixHQUFvQixFQUF2QyxDQU5OO1dBUUEsSUFUTztFQUFBLENBNVBUOztBQUFBLGtCQWtSQSxhQUFZLFNBQUMsTUFBRDtBQUNWO0FBQUEsWUFDRTtBQUFBLGNBQVEsTUFBUjtBQUFBLE1BQ0EsTUFBTSxLQUROO0FBQUEsTUFFQSxRQUFRLEtBRlI7QUFBQSxNQUdBLFNBQVMsUUFIVDtBQUFBLE1BSUEsUUFBUSxLQUpSO0tBREY7V0FPQSxLQUFNLFNBUkk7RUFBQSxDQWxSWjs7QUFBQSxrQkFrU0EsV0FBVSxTQUFDLEdBQUQ7QUFDUjtBQUFBLGFBQVUsR0FBRyxDQUFDLE9BQWQ7QUFBQSxJQUNBLFVBQVUsR0FBRyxxQkFBSCxJQUE0QixNQUE1QixHQUFxQyxHQUFHLGtCQUFILENBRC9DO0FBR0EsUUFBRyxHQUFHLENBQUMsT0FBSixLQUFlLFFBQWxCO0FBQ0UsZ0JBQVUsR0FBRyxxREFBSCxDQUFWLENBREY7S0FBQSxNQUVLLElBQUcsR0FBRyxDQUFDLE9BQUosS0FBZSxNQUFmLElBQXlCLElBQUksQ0FBQyxHQUFqQztBQUNILGdCQUFVLEdBQUcscUJBQUgsSUFDQSxNQURBLEdBRUEsR0FBRyxpQ0FBSCxDQUZWLENBREc7S0FMTDtBQVVBLFlBQU8sR0FBRyxDQUFDLE1BQVg7QUFBQSxXQUNPLEdBRFA7QUFFSSxrQkFBVSxHQUFHLCtCQUFILElBQ0EsTUFEQSxHQUVBLEdBQUcsa0JBQUgsQ0FGVixDQUZKO0FBQ087QUFEUCxXQUtPLEdBTFA7QUFNSSxrQkFBVSxHQUFHLHFEQUFILENBQVYsQ0FOSjtBQUtPO0FBTFAsV0FPTyxHQVBQO0FBUUksa0JBQVUsR0FBRyxzREFBSCxDQUFWLENBUko7QUFBQSxLQVZBO0FBQUEsSUFvQkEsU0FBUyxDQUFDLGdCQUFWLENBQTJCLE9BQTNCLEVBQW9DLFNBQVMsQ0FBQyxZQUFZLENBQUMsS0FBM0QsQ0FwQkE7V0FzQkEsT0FBTyxDQUFDLEtBQVIsQ0FBYyxHQUFHLHFCQUFILElBQTRCLENBQUMsT0FBRyxHQUFHLENBQUMsTUFBUCxHQUFlLEdBQWhCLENBQTFDLEVBdkJRO0VBQUEsQ0FsU1Y7O2VBQUE7O0lBbEJGOztBQUFBLFNBNlVTLENBQUMsTUFBTSxDQUFDLFFBQWpCLENBQTBCLE9BQTFCLEVBQW1DLEtBQW5DLENBN1VBOztBQUFBLE1BK1VNLENBQUMsT0FBUCxHQUFpQixLQS9VakIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIiMgSW4gb3JkZXIgdG8gYnVpbGQgcG9ydGFibGUgZXh0ZW5zaW9uIGJ1bmRsZXMgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIEFNRCBhbmRcbiMgc2NyaXB0IGNvbmNhdGVuYXRpb24gcGx1Z2lucyBhcmUgYnVpbHQgd2l0aCB0aGlzIG1vZHVsZSBhcyAnYW5ub3RhdG9yJy5cblxuIyBBbm5vdGF0b3Igd2lsbCBleHBvcnQgaXRzZWxmIGdsb2JhbGx5IHdoZW4gdGhlIGJ1aWx0IFVNRCBtb2R1bGVzIGFyZSB1c2VkIGluXG4jIGEgbGVnYWN5IGVudmlyb25tZW50IG9mIHNpbXBsZSBzY3JpcHQgY29uY2F0ZW5hdGlvbi5cbnNlbGYgPSBzZWxmIGlmIHNlbGY/XG5zZWxmID89IGdsb2JhbCBpZiBnbG9iYWw/XG5zZWxmID89IHdpbmRvdyBpZiB3aW5kb3c/XG5Bbm5vdGF0b3IgPSBzZWxmPy5Bbm5vdGF0b3JcblxuIyBJbiBhIHB1cmUgQU1EIGVudmlyb25tZW50LCBBbm5vdGF0b3IgbWF5IG5vdCBiZSBleHBvcnRlZCBnbG9iYWxseS5cbkFubm90YXRvciA/PSBpZiBzZWxmPy5kZWZpbmU/LmFtZCB0aGVuIHNlbGY/LnJlcXVpcmUoJ2Fubm90YXRvcicpXG5cbiMgSWYgd2UgaGF2ZW4ndCBzdWNjZXNzZnVsbHkgbG9hZGVkIEFubm90YXRvciBieSB0aGlzIHBvaW50LCB0aGVyZSdzIG5vIHBvaW50IGluXG4jIGdvaW5nIG9uIHRvIGxvYWQgdGhlIHBsdWdpbiwgc28gdGhyb3cgYSBmYXRhbCBlcnJvci5cbmlmIHR5cGVvZiBBbm5vdGF0b3IgaXNudCAnZnVuY3Rpb24nXG4gIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBmaW5kIEFubm90YXRvciEgSW4gYSB3ZWJwYWdlIGNvbnRleHQsIHBsZWFzZSBlbnN1cmVcbiAgICAgICAgICAgICAgICAgICB0aGF0IHRoZSBBbm5vdGF0b3Igc2NyaXB0IHRhZyBpcyBsb2FkZWQgYmVmb3JlIGFueSBwbHVnaW5zLlwiKVxuXG4jIE5vdGU6IHdoZW4gd29ya2luZyBpbiBhIENvbW1vbkpTIGVudmlyb25tZW50IGFuZCBidW5kbGluZyByZXF1aXJlbWVudHMgaW50b1xuIyBhcHBsaWNhdGlvbnMgdGhlbiByZXF1aXJlIGNhbGxzIHNob3VsZCByZWZlciB0byBtb2R1bGVzIGZyb20gdGhlIG5wbSBsaWJcbiMgZGlyZWN0b3J5IG9mIGFubm90YXRvciBwYWNrYWdlIGFuZCBhdm9pZCB0aGlzIGFsdG9nZXRoZXIuXG5tb2R1bGUuZXhwb3J0cyA9IEFubm90YXRvclxuIiwiQW5ub3RhdG9yID0gcmVxdWlyZSgnYW5ub3RhdG9yJylcblV0aWwgPSBBbm5vdGF0b3IuVXRpbFxuJCA9IFV0aWwuJFxuX3QgPSBVdGlsLlRyYW5zbGF0aW9uU3RyaW5nXG5cblxuIyBQdWJsaWM6IFRoZSBTdG9yZSBwbHVnaW4gY2FuIGJlIHVzZWQgdG8gcGVyc2lzdCBhbm5vdGF0aW9ucyB0byBhIGRhdGFiYXNlXG4jIHJ1bm5pbmcgb24geW91ciBzZXJ2ZXIuIEl0IGhhcyBhIHNpbXBsZSBjdXN0b21pc2FibGUgaW50ZXJmYWNlIHRoYXQgY2FuIGJlXG4jIGltcGxlbWVudGVkIHdpdGggYW55IHdlYiBmcmFtZXdvcmsuIEl0IHdvcmtzIGJ5IGxpc3RlbmluZyB0byBldmVudHMgcHVibGlzaGVkXG4jIGJ5IHRoZSBBbm5vdGF0b3IgYW5kIG1ha2luZyBhcHByb3ByaWF0ZSByZXF1ZXN0cyB0byB0aGUgc2VydmVyIGRlcGVuZGluZyBvblxuIyB0aGUgZXZlbnQuXG4jXG4jIFRoZSBzdG9yZSBoYW5kbGVzIGZpdmUgZGlzdGluY3QgYWN0aW9ucyBcInJlYWRcIiwgXCJzZWFyY2hcIiwgXCJjcmVhdGVcIiwgXCJ1cGRhdGVcIlxuIyBhbmQgXCJkZXN0cm95XCIuIFRoZSByZXF1ZXN0cyBtYWRlIGNhbiBiZSBjdXN0b21pc2VkIHdpdGggb3B0aW9ucyB3aGVuIHRoZVxuIyBwbHVnaW4gaXMgYWRkZWQgdG8gdGhlIEFubm90YXRvci5cbmNsYXNzIFN0b3JlXG5cbiAgIyBVc2VyIGN1c3RvbWlzYWJsZSBvcHRpb25zIGF2YWlsYWJsZS5cbiAgb3B0aW9uczpcblxuICAgICMgQ3VzdG9tIG1ldGEgZGF0YSB0aGF0IHdpbGwgYmUgYXR0YWNoZWQgdG8gZXZlcnkgYW5ub3RhdGlvbiB0aGF0IGlzIHNlbnRcbiAgICAjIHRvIHRoZSBzZXJ2ZXIuIFRoaXMgX3dpbGxfIG92ZXJyaWRlIHByZXZpb3VzIHZhbHVlcy5cbiAgICAjXG4gICAgIyBAc2xhdGVkRm9yRGVwcmVjYXRpb24gMi4xLjBcbiAgICBhbm5vdGF0aW9uRGF0YTogbnVsbFxuXG4gICAgIyBTaG91bGQgdGhlIHBsdWdpbiBlbXVsYXRlIEhUVFAgbWV0aG9kcyBsaWtlIFBVVCBhbmQgREVMRVRFIGZvclxuICAgICMgaW50ZXJhY3Rpb24gd2l0aCBsZWdhY3kgd2ViIHNlcnZlcnM/IFNldHRpbmcgdGhpcyB0byBgdHJ1ZWAgd2lsbCBmYWtlXG4gICAgIyBIVFRQIGBQVVRgIGFuZCBgREVMRVRFYCByZXF1ZXN0cyB3aXRoIGFuIEhUVFAgYFBPU1RgLCBhbmQgd2lsbCBzZXQgdGhlXG4gICAgIyByZXF1ZXN0IGhlYWRlciBgWC1IVFRQLU1ldGhvZC1PdmVycmlkZWAgd2l0aCB0aGUgbmFtZSBvZiB0aGUgZGVzaXJlZFxuICAgICMgbWV0aG9kLlxuICAgIGVtdWxhdGVIVFRQOiBmYWxzZVxuXG4gICAgIyBTaG91bGQgdGhlIHBsdWdpbiBlbXVsYXRlIEpTT04gUE9TVC9QVVQgcGF5bG9hZHMgYnkgc2VuZGluZyBpdHMgcmVxdWVzdHNcbiAgICAjIGFzIGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCB3aXRoIGEgc2luZ2xlIGtleSwgXCJqc29uXCJcbiAgICBlbXVsYXRlSlNPTjogZmFsc2VcblxuICAgICMgQSBzZXQgb2YgY3VzdG9tIGhlYWRlcnMgdGhhdCB3aWxsIGJlIHNlbnQgd2l0aCBldmVyeSByZXF1ZXN0LiBTZWUgYWxzbyB0aGVcbiAgICAjIHNldEhlYWRlciBtZXRob2QuXG4gICAgaGVhZGVyczoge31cblxuICAgICMgVGhpcyBpcyB0aGUgQVBJIGVuZHBvaW50LiBJZiB0aGUgc2VydmVyIHN1cHBvcnRzIENyb3NzIE9yaWdpbiBSZXNvdXJjZVxuICAgICMgU2hhcmluZyAoQ09SUykgYSBmdWxsIFVSTCBjYW4gYmUgdXNlZCBoZXJlLlxuICAgIHByZWZpeDogJy9zdG9yZSdcblxuICAgICMgVGhlIHNlcnZlciBVUkxzIGZvciBlYWNoIGF2YWlsYWJsZSBhY3Rpb24uIFRoZXNlIFVSTHMgY2FuIGJlIGFueXRoaW5nIGJ1dFxuICAgICMgbXVzdCByZXNwb25kIHRvIHRoZSBhcHByb3ByYWl0ZSBIVFRQIG1ldGhvZC4gVGhlIHRva2VuIFwiOmlkXCIgY2FuIGJlIHVzZWRcbiAgICAjIGFueXdoZXJlIGluIHRoZSBVUkwgYW5kIHdpbGwgYmUgcmVwbGFjZWQgd2l0aCB0aGUgYW5ub3RhdGlvbiBpZC5cbiAgICAjXG4gICAgIyByZWFkOiAgICBHRVRcbiAgICAjIGNyZWF0ZTogIFBPU1RcbiAgICAjIHVwZGF0ZTogIFBVVFxuICAgICMgZGVzdHJveTogREVMRVRFXG4gICAgIyBzZWFyY2g6ICBHRVRcbiAgICB1cmxzOlxuICAgICAgY3JlYXRlOiAnL2Fubm90YXRpb25zJ1xuICAgICAgcmVhZDogJy9hbm5vdGF0aW9ucy86aWQnXG4gICAgICB1cGRhdGU6ICcvYW5ub3RhdGlvbnMvOmlkJ1xuICAgICAgZGVzdHJveTogJy9hbm5vdGF0aW9ucy86aWQnXG4gICAgICBzZWFyY2g6ICcvc2VhcmNoJ1xuXG4gICMgUHVibGljOiBUaGUgY29udHNydWN0b3IgaW5pdGFpbGFzZXMgdGhlIFN0b3JlIGluc3RhbmNlLiBJdCByZXF1aXJlcyB0aGVcbiAgIyBBbm5vdGF0b3IjZWxlbWVudCBhbmQgYW4gT2JqZWN0IG9mIG9wdGlvbnMuXG4gICNcbiAgIyBlbGVtZW50IC0gVGhpcyBtdXN0IGJlIHRoZSBBbm5vdGF0b3IjZWxlbWVudCBpbiBvcmRlciB0byBsaXN0ZW4gZm9yIGV2ZW50cy5cbiAgIyBvcHRpb25zIC0gQW4gT2JqZWN0IG9mIGtleS92YWx1ZSB1c2VyIG9wdGlvbnMuXG4gICNcbiAgIyBFeGFtcGxlc1xuICAjXG4gICMgICBzdG9yZSA9IG5ldyBBbm5vdGF0b3IuUGx1Z2luLlN0b3JlKEFubm90YXRvci5lbGVtZW50LCB7XG4gICMgICAgIHByZWZpeDogJ2h0dHA6Ly9hbm5vdGF0ZWl0Lm9yZycsXG4gICMgICAgIGFubm90YXRpb25EYXRhOiB7XG4gICMgICAgICAgdXJpOiB3aW5kb3cubG9jYXRpb24uaHJlZlxuICAjICAgICB9XG4gICMgICB9KVxuICAjXG4gICMgUmV0dXJucyBhIG5ldyBpbnN0YW5jZSBvZiBTdG9yZS5cbiAgY29uc3RydWN0b3I6IChvcHRpb25zKSAtPlxuICAgICMgSWYgaW5zdGFudGlhdGVkIGluIGxlZ2FjeSBtb2RlIHdpdGggYW5ub3RhdG9yLmFkZFBsdWdpbignU3RvcmUnLCB7Li4ufSksXG4gICAgIyB0aGVuIHRoZSBmaXJzdCBhcmd1bWVudCB3aWxsIGJlIHRoZSBBbm5vdGF0b3IncyBlbGVtZW50LiBXZSBkb24ndCBuZWVkIHRoZVxuICAgICMgZWxlbWVudDogZGlzY2FyZCBpdC5cbiAgICBpZiBhcmd1bWVudHMubGVuZ3RoID4gMVxuICAgICAgb3B0aW9ucyA9IGFyZ3VtZW50c1sxXVxuXG4gICAgQG9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgQG9wdGlvbnMsIG9wdGlvbnMpXG5cbiAgICBpZiBAb3B0aW9ucy5sb2FkRnJvbVNlYXJjaFxuICAgICAgVXRpbC5kZXByZWNhdGlvbldhcm5pbmcoXCJVc2Ugb2YgdGhlIGxvYWRGcm9tU2VhcmNoIG9wdGlvbiB0byB0aGUgU3RvcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW4gaXMgZGVwcmVjYXRlZC4gUGxlYXNlIGNhbGxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubG9hZChxdWVyeU9iaikgb24gdGhlIEFubm90YXRvciBpbnN0YW5jZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RlYWQuXCIpXG5cbiAgIyBTdXBwb3J0IGZvciBsZWdhY3kgaW5zdGFudGlhdGlvbiBvZiBTdG9yZSBwbHVnaW4gd2l0aCAuYWRkUGx1Z2luKCdTdG9yZScpXG4gIHBsdWdpbkluaXQ6IC0+XG4gICAgQGFubm90YXRvci5zdG9yZSA9IHRoaXNcbiAgICBpZiBAb3B0aW9ucy5sb2FkRnJvbVNlYXJjaFxuICAgICAgQGFubm90YXRvci5sb2FkKEBvcHRpb25zLmxvYWRGcm9tU2VhcmNoKVxuXG4gICMgUHVibGljOiBDYWxsYmFjayBtZXRob2QgZm9yIGFubm90YXRpb25DcmVhdGVkIGV2ZW50LiBSZWNlaXZlcyBhbiBhbm5vdGF0aW9uXG4gICMgYW5kIHNlbmRzIGEgUE9TVCByZXF1ZXN0IHRvIHRoZSBzZXZlciB1c2luZyB0aGUgVVJJIGZvciB0aGUgXCJjcmVhdGVcIiBhY3Rpb24uXG4gICNcbiAgIyBhbm5vdGF0aW9uIC0gQW4gYW5ub3RhdGlvbiBPYmplY3QgdGhhdCB3YXMgY3JlYXRlZC5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIHN0b3JlLmFubm90YXRpb25DcmVhdGVkKHt0ZXh0OiBcIm15IG5ldyBhbm5vdGF0aW9uIGNvbW1lbnRcIn0pXG4gICMgICAjID0+IFJlc3VsdHMgaW4gYW4gSFRUUCBQT1NUIHJlcXVlc3QgdG8gdGhlIHNlcnZlciBjb250YWluaW5nIHRoZVxuICAjICAgIyAgICBhbm5vdGF0aW9uIGFzIHNlcmlhbGlzZWQgSlNPTi5cbiAgI1xuICAjIFJldHVybnMgYSBqcVhIUiBvYmplY3QuXG4gIGNyZWF0ZTogKGFubm90YXRpb24pIC0+XG4gICAgdGhpcy5fYXBpUmVxdWVzdCgnY3JlYXRlJywgYW5ub3RhdGlvbilcblxuICAjIFB1YmxpYzogQ2FsbGJhY2sgbWV0aG9kIGZvciBhbm5vdGF0aW9uVXBkYXRlZCBldmVudC4gUmVjZWl2ZXMgYW4gYW5ub3RhdGlvblxuICAjIGFuZCBzZW5kcyBhIFBVVCByZXF1ZXN0IHRvIHRoZSBzZXZlciB1c2luZyB0aGUgVVJJIGZvciB0aGUgXCJ1cGRhdGVcIiBhY3Rpb24uXG4gICNcbiAgIyBhbm5vdGF0aW9uIC0gQW4gYW5ub3RhdGlvbiBPYmplY3QgdGhhdCB3YXMgdXBkYXRlZC5cbiAgI1xuICAjIEV4YW1wbGVzXG4gICNcbiAgIyAgIHN0b3JlLmFubm90YXRpb25VcGRhdGVkKHtpZDogXCJibGFoXCIsIHRleHQ6IFwidXBkYXRlZCBhbm5vdGF0aW9uIGNvbW1lbnRcIn0pXG4gICMgICAjID0+IFJlc3VsdHMgaW4gYW4gSFRUUCBQVVQgcmVxdWVzdCB0byB0aGUgc2VydmVyIGNvbnRhaW5pbmcgdGhlXG4gICMgICAjICAgIGFubm90YXRpb24gYXMgc2VyaWFsaXNlZCBKU09OLlxuICAjXG4gICMgUmV0dXJucyBhIGpxWEhSIG9iamVjdC5cbiAgdXBkYXRlOiAoYW5ub3RhdGlvbikgLT5cbiAgICB0aGlzLl9hcGlSZXF1ZXN0KCd1cGRhdGUnLCBhbm5vdGF0aW9uKVxuXG4gICMgUHVibGljOiBDYWxsYmFjayBtZXRob2QgZm9yIGFubm90YXRpb25EZWxldGVkIGV2ZW50LiBSZWNlaXZlcyBhbiBhbm5vdGF0aW9uXG4gICMgYW5kIHNlbmRzIGEgREVMRVRFIHJlcXVlc3QgdG8gdGhlIHNlcnZlciB1c2luZyB0aGUgVVJJIGZvciB0aGUgZGVzdHJveVxuICAjIGFjdGlvbi5cbiAgI1xuICAjIGFubm90YXRpb24gLSBBbiBhbm5vdGF0aW9uIE9iamVjdCB0aGF0IHdhcyBkZWxldGVkLlxuICAjXG4gICMgRXhhbXBsZXNcbiAgI1xuICAjICAgc3RvcmUuYW5ub3RhdGlvbkRlbGV0ZWQoe3RleHQ6IFwibXkgbmV3IGFubm90YXRpb24gY29tbWVudFwifSlcbiAgIyAgICMgPT4gUmVzdWx0cyBpbiBhbiBIVFRQIERFTEVURSByZXF1ZXN0IHRvIHRoZSBzZXJ2ZXIuXG4gICNcbiAgIyBSZXR1cm5zIGEganFYSFIgb2JqZWN0LlxuICBkZWxldGU6IChhbm5vdGF0aW9uKSAtPlxuICAgIHRoaXMuX2FwaVJlcXVlc3QoJ2Rlc3Ryb3knLCBhbm5vdGF0aW9uKVxuXG4gICMgUHVibGljOiBTZWFyY2hlcyBmb3IgYW5ub3RhdGlvbnMgbWF0Y2hpbmcgdGhlIHNwZWNpZmllZCBxdWVyeS5cbiAgI1xuICAjIFJldHVybnMgYSBQcm9taXNlIHJlc29sdmluZyB0byB0aGUgcXVlcnkgcmVzdWx0cyBhbmQgcXVlcnkgbWV0YWRhdGEuXG4gIHF1ZXJ5OiAocXVlcnlPYmopIC0+XG4gICAgZGZkID0gJC5EZWZlcnJlZCgpXG4gICAgdGhpcy5fYXBpUmVxdWVzdCgnc2VhcmNoJywgcXVlcnlPYmopXG4gICAgLmRvbmUgKG9iaikgLT5cbiAgICAgIHJvd3MgPSBvYmoucm93c1xuICAgICAgZGVsZXRlIG9iai5yb3dzXG4gICAgICBkZmQucmVzb2x2ZShyb3dzLCBvYmopXG4gICAgLmZhaWwgLT5cbiAgICAgIGRmZC5yZWplY3QuYXBwbHkoZGZkLCBhcmd1bWVudHMpXG4gICAgcmV0dXJuIGRmZC5wcm9taXNlKClcblxuICAjIFB1YmxpYzogU2V0IGEgY3VzdG9tIEhUVFAgaGVhZGVyIHRvIGJlIHNlbnQgd2l0aCBldmVyeSByZXF1ZXN0LlxuICAjXG4gICMga2V5ICAgLSBUaGUgaGVhZGVyIG5hbWUuXG4gICMgdmFsdWUgLSBUaGUgaGVhZGVyIHZhbHVlLlxuICAjXG4gICMgRXhhbXBsZXM6XG4gICNcbiAgIyAgIHN0b3JlLnNldEhlYWRlcignWC1NeS1DdXN0b20tSGVhZGVyJywgJ015Q3VzdG9tVmFsdWUnKVxuICAjXG4gICMgUmV0dXJucyBub3RoaW5nLlxuICBzZXRIZWFkZXI6IChrZXksIHZhbHVlKSAtPlxuICAgIHRoaXMub3B0aW9ucy5oZWFkZXJzW2tleV0gPSB2YWx1ZVxuXG4gICMgQ2FsbGJhY2sgbWV0aG9kIGZvciBTdG9yZSNsb2FkQW5ub3RhdGlvbnNGcm9tU2VhcmNoKCkuIFByb2Nlc3NlcyB0aGUgZGF0YVxuICAjIHJldHVybmVkIGZyb20gdGhlIHNlcnZlciAoYSBKU09OIGFycmF5IG9mIGFubm90YXRpb24gT2JqZWN0cykgYW5kIHVwZGF0ZXNcbiAgIyB0aGUgcmVnaXN0cnkgYXMgd2VsbCBhcyBsb2FkaW5nIHRoZW0gaW50byB0aGUgQW5ub3RhdG9yLlxuICAjIFJldHVybnMgdGhlIGpRdWVyeSBYTUxIdHRwUmVxdWVzdCB3cmFwcGVyIGVuYWJsaW5nIGFkZGl0aW9uYWwgY2FsbGJhY2tzIHRvXG4gICMgYmUgYXBwbGllZCBhcyB3ZWxsIGFzIGN1c3RvbSBlcnJvciBoYW5kbGluZy5cbiAgI1xuICAjIGFjdGlvbiAgICAtIFRoZSBhY3Rpb24gU3RyaW5nIGVnLiBcInJlYWRcIiwgXCJzZWFyY2hcIiwgXCJjcmVhdGVcIiwgXCJ1cGRhdGVcIlxuICAjICAgICAgICAgICAgIG9yIFwiZGVzdG9yeVwiLlxuICAjIG9iaiAgICAgICAtIFRoZSBkYXRhIHRvIGJlIHNlbnQsIGVpdGhlciBhbm5vdGF0aW9uIG9iamVjdCBvciBxdWVyeSBzdHJpbmcuXG4gICMgb25TdWNjZXNzIC0gQSBjYWxsYmFjayBGdW5jdGlvbiB0byBjYWxsIG9uIHN1Y2Nlc3NmdWwgcmVxdWVzdC5cbiAgI1xuICAjIEV4YW1wbGVzOlxuICAjXG4gICMgICBzdG9yZS5fYXBpUmVxdWVzdCgncmVhZCcsIHtpZDogNH0sIChkYXRhKSAtPiBjb25zb2xlLmxvZyhkYXRhKSlcbiAgIyAgICMgPT4gT3V0cHV0cyB0aGUgYW5ub3RhdGlvbiByZXR1cm5lZCBmcm9tIHRoZSBzZXJ2ZXIuXG4gICNcbiAgIyBSZXR1cm5zIFhNTEh0dHBSZXF1ZXN0IG9iamVjdC5cbiAgX2FwaVJlcXVlc3Q6IChhY3Rpb24sIG9iaikgLT5cbiAgICBpZCA9IG9iaiAmJiBvYmouaWRcbiAgICB1cmwgPSB0aGlzLl91cmxGb3IoYWN0aW9uLCBpZClcbiAgICBvcHRpb25zID0gdGhpcy5fYXBpUmVxdWVzdE9wdGlvbnMoYWN0aW9uLCBvYmopXG5cbiAgICByZXF1ZXN0ID0gJC5hamF4KHVybCwgb3B0aW9ucylcblxuICAgICMgQXBwZW5kIHRoZSBpZCBhbmQgYWN0aW9uIHRvIHRoZSByZXF1ZXN0IG9iamVjdFxuICAgICMgZm9yIHVzZSBpbiB0aGUgZXJyb3IgY2FsbGJhY2suXG4gICAgcmVxdWVzdC5faWQgPSBpZFxuICAgIHJlcXVlc3QuX2FjdGlvbiA9IGFjdGlvblxuICAgIHJlcXVlc3RcblxuICAjIEJ1aWxkcyBhbiBvcHRpb25zIG9iamVjdCBzdWl0YWJsZSBmb3IgdXNlIGluIGEgalF1ZXJ5LmFqYXgoKSBjYWxsLlxuICAjXG4gICMgYWN0aW9uICAgIC0gVGhlIGFjdGlvbiBTdHJpbmcgZWcuIFwicmVhZFwiLCBcInNlYXJjaFwiLCBcImNyZWF0ZVwiLCBcInVwZGF0ZVwiXG4gICMgICAgICAgICAgICAgb3IgXCJkZXN0cm95XCIuXG4gICMgb2JqICAgICAgIC0gVGhlIGRhdGEgdG8gYmUgc2VudCwgZWl0aGVyIGFubm90YXRpb24gb2JqZWN0IG9yIHF1ZXJ5IHN0cmluZy5cbiAgI1xuICAjIFJldHVybnMgT2JqZWN0IGxpdGVyYWwgb2YgJC5hamF4KCkgb3B0aW9ucy5cbiAgX2FwaVJlcXVlc3RPcHRpb25zOiAoYWN0aW9uLCBvYmopIC0+XG4gICAgbWV0aG9kID0gdGhpcy5fbWV0aG9kRm9yKGFjdGlvbilcblxuICAgIG9wdHMgPVxuICAgICAgdHlwZTogbWV0aG9kLFxuICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxuICAgICAgZXJyb3I6IHRoaXMuX29uRXJyb3IsXG4gICAgICBoZWFkZXJzOiB0aGlzLm9wdGlvbnMuaGVhZGVyc1xuXG4gICAgIyBJZiBlbXVsYXRlSFRUUCBpcyBlbmFibGVkLCB3ZSBzZW5kIGEgUE9TVCBhbmQgcHV0IHRoZSByZWFsIG1ldGhvZCBpbiBhblxuICAgICMgSFRUUCByZXF1ZXN0IGhlYWRlci5cbiAgICBpZiBAb3B0aW9ucy5lbXVsYXRlSFRUUCBhbmQgbWV0aG9kIGluIFsnUFVUJywgJ0RFTEVURSddXG4gICAgICBvcHRzLmhlYWRlcnMgPSAkLmV4dGVuZChvcHRzLmhlYWRlcnMsIHsnWC1IVFRQLU1ldGhvZC1PdmVycmlkZSc6IG1ldGhvZH0pXG4gICAgICBvcHRzLnR5cGUgPSAnUE9TVCdcblxuICAgICMgRG9uJ3QgSlNPTmlmeSBvYmogaWYgbWFraW5nIHNlYXJjaCByZXF1ZXN0LlxuICAgIGlmIGFjdGlvbiBpcyBcInNlYXJjaFwiXG4gICAgICBvcHRzID0gJC5leHRlbmQob3B0cywgZGF0YTogb2JqKVxuICAgICAgcmV0dXJuIG9wdHNcblxuICAgICMgQWRkIGFubm90YXRpb25EYXRhIHRvIG9iamVjdCwgaWYgc3BlY2lmaWVkXG4gICAgI1xuICAgICMgQHNsYXRlZEZvckRlcHJlY2F0aW9uIDIuMS4wXG4gICAgaWYgQG9wdGlvbnMuYW5ub3RhdGlvbkRhdGE/XG4gICAgICBVdGlsLmRlcHJlY2F0aW9uV2FybmluZyhcIlVzZSBvZiB0aGUgYW5ub3RhdGlvbkRhdGEgb3B0aW9uIHRvIHRoZSBTdG9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsdWdpbiBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1dHVyZSB2ZXJzaW9uLiBQbGVhc2UgdXNlIGhvb2tzIHRvXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlQW5ub3RhdGlvbkNyZWF0ZWQgYW5kXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlQW5ub3RhdGlvblVwZGF0ZWQgdG8gcmVwbGljYXRlIHRoaXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWhhdmlvdXIuXCIpXG4gICAgICAkLmV4dGVuZChvYmosIEBvcHRpb25zLmFubm90YXRpb25EYXRhKVxuXG4gICAgZGF0YSA9IG9iaiAmJiBKU09OLnN0cmluZ2lmeShvYmopXG5cbiAgICAjIElmIGVtdWxhdGVKU09OIGlzIGVuYWJsZWQsIHdlIHNlbmQgYSBmb3JtIHJlcXVlc3QgKHRoZSBjb3JyZWN0XG4gICAgIyBjb250ZW50VHlwZSB3aWxsIGJlIHNldCBhdXRvbWF0aWNhbGx5IGJ5IGpRdWVyeSksIGFuZCBwdXQgdGhlXG4gICAgIyBKU09OLWVuY29kZWQgcGF5bG9hZCBpbiB0aGUgXCJqc29uXCIga2V5LlxuICAgIGlmIEBvcHRpb25zLmVtdWxhdGVKU09OXG4gICAgICBvcHRzLmRhdGEgPSB7anNvbjogZGF0YX1cbiAgICAgIGlmIEBvcHRpb25zLmVtdWxhdGVIVFRQXG4gICAgICAgIG9wdHMuZGF0YS5fbWV0aG9kID0gbWV0aG9kXG4gICAgICByZXR1cm4gb3B0c1xuXG4gICAgb3B0cyA9ICQuZXh0ZW5kKG9wdHMsIHtcbiAgICAgIGRhdGE6IGRhdGFcbiAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxuICAgIH0pXG4gICAgcmV0dXJuIG9wdHNcblxuICAjIEJ1aWxkcyB0aGUgYXBwcm9wcmlhdGUgVVJMIGZyb20gdGhlIG9wdGlvbnMgZm9yIHRoZSBhY3Rpb24gcHJvdmlkZWQuXG4gICNcbiAgIyBhY3Rpb24gLSBUaGUgYWN0aW9uIFN0cmluZy5cbiAgIyBpZCAgICAgLSBUaGUgYW5ub3RhdGlvbiBpZCBhcyBhIFN0cmluZyBvciBOdW1iZXIuXG4gICNcbiAgIyBFeGFtcGxlc1xuICAjXG4gICMgICBzdG9yZS5fdXJsRm9yKCd1cGRhdGUnLCAzNClcbiAgIyAgICMgPT4gUmV0dXJucyBcIi9zdG9yZS9hbm5vdGF0aW9ucy8zNFwiXG4gICNcbiAgIyAgIHN0b3JlLl91cmxGb3IoJ3NlYXJjaCcpXG4gICMgICAjID0+IFJldHVybnMgXCIvc3RvcmUvc2VhcmNoXCJcbiAgI1xuICAjIFJldHVybnMgVVJMIFN0cmluZy5cbiAgX3VybEZvcjogKGFjdGlvbiwgaWQpIC0+XG4gICAgdXJsID0gaWYgQG9wdGlvbnMucHJlZml4PyB0aGVuIEBvcHRpb25zLnByZWZpeCBlbHNlICcnXG4gICAgdXJsICs9IEBvcHRpb25zLnVybHNbYWN0aW9uXVxuICAgICMgSWYgdGhlcmUncyBhICcvOmlkJyBpbiB0aGUgVVJMLCBlaXRoZXIgZmlsbCBpbiB0aGUgSUQgb3IgcmVtb3ZlIHRoZVxuICAgICMgc2xhc2g6XG4gICAgdXJsID0gdXJsLnJlcGxhY2UoL1xcLzppZC8sIGlmIGlkPyB0aGVuICcvJyArIGlkIGVsc2UgJycpXG4gICAgIyBJZiB0aGVyZSdzIGEgYmFyZSAnOmlkJyBpbiB0aGUgVVJMLCB0aGVuIHN1YnN0aXR1dGUgZGlyZWN0bHk6XG4gICAgdXJsID0gdXJsLnJlcGxhY2UoLzppZC8sIGlmIGlkPyB0aGVuIGlkIGVsc2UgJycpXG5cbiAgICB1cmxcblxuICAjIE1hcHMgYW4gYWN0aW9uIHRvIGFuIEhUVFAgbWV0aG9kLlxuICAjXG4gICMgYWN0aW9uIC0gVGhlIGFjdGlvbiBTdHJpbmcuXG4gICNcbiAgIyBFeGFtcGxlc1xuICAjXG4gICMgICBzdG9yZS5fbWV0aG9kRm9yKCdyZWFkJykgICAgIyA9PiBcIkdFVFwiXG4gICMgICBzdG9yZS5fbWV0aG9kRm9yKCd1cGRhdGUnKSAgIyA9PiBcIlBVVFwiXG4gICMgICBzdG9yZS5fbWV0aG9kRm9yKCdkZXN0cm95JykgIyA9PiBcIkRFTEVURVwiXG4gICNcbiAgIyBSZXR1cm5zIEhUVFAgbWV0aG9kIFN0cmluZy5cbiAgX21ldGhvZEZvcjogKGFjdGlvbikgLT5cbiAgICB0YWJsZSA9XG4gICAgICBjcmVhdGU6ICdQT1NUJ1xuICAgICAgcmVhZDogJ0dFVCdcbiAgICAgIHVwZGF0ZTogJ1BVVCdcbiAgICAgIGRlc3Ryb3k6ICdERUxFVEUnXG4gICAgICBzZWFyY2g6ICdHRVQnXG5cbiAgICB0YWJsZVthY3Rpb25dXG5cbiAgIyBqUXVlcnkuYWpheCgpIGNhbGxiYWNrLiBEaXNwbGF5cyBhbiBlcnJvciBub3RpZmljYXRpb24gdG8gdGhlIHVzZXIgaWZcbiAgIyB0aGUgcmVxdWVzdCBmYWlsZWQuXG4gICNcbiAgIyB4aHIgLSBUaGUgalhNTEh0dHBSZXF1ZXN0IG9iamVjdC5cbiAgI1xuICAjIFJldHVybnMgbm90aGluZy5cbiAgX29uRXJyb3I6ICh4aHIpIC0+XG4gICAgYWN0aW9uICA9IHhoci5fYWN0aW9uXG4gICAgbWVzc2FnZSA9IF90KFwiU29ycnkgd2UgY291bGQgbm90IFwiKSArIGFjdGlvbiArIF90KFwiIHRoaXMgYW5ub3RhdGlvblwiKVxuXG4gICAgaWYgeGhyLl9hY3Rpb24gPT0gJ3NlYXJjaCdcbiAgICAgIG1lc3NhZ2UgPSBfdChcIlNvcnJ5IHdlIGNvdWxkIG5vdCBzZWFyY2ggdGhlIHN0b3JlIGZvciBhbm5vdGF0aW9uc1wiKVxuICAgIGVsc2UgaWYgeGhyLl9hY3Rpb24gPT0gJ3JlYWQnICYmICF4aHIuX2lkXG4gICAgICBtZXNzYWdlID0gX3QoXCJTb3JyeSB3ZSBjb3VsZCBub3QgXCIpICtcbiAgICAgICAgICAgICAgICBhY3Rpb24gK1xuICAgICAgICAgICAgICAgIF90KFwiIHRoZSBhbm5vdGF0aW9ucyBmcm9tIHRoZSBzdG9yZVwiKVxuXG4gICAgc3dpdGNoIHhoci5zdGF0dXNcbiAgICAgIHdoZW4gNDAxXG4gICAgICAgIG1lc3NhZ2UgPSBfdChcIlNvcnJ5IHlvdSBhcmUgbm90IGFsbG93ZWQgdG8gXCIpICtcbiAgICAgICAgICAgICAgICAgIGFjdGlvbiArXG4gICAgICAgICAgICAgICAgICBfdChcIiB0aGlzIGFubm90YXRpb25cIilcbiAgICAgIHdoZW4gNDA0XG4gICAgICAgIG1lc3NhZ2UgPSBfdChcIlNvcnJ5IHdlIGNvdWxkIG5vdCBjb25uZWN0IHRvIHRoZSBhbm5vdGF0aW9ucyBzdG9yZVwiKVxuICAgICAgd2hlbiA1MDBcbiAgICAgICAgbWVzc2FnZSA9IF90KFwiU29ycnkgc29tZXRoaW5nIHdlbnQgd3Jvbmcgd2l0aCB0aGUgYW5ub3RhdGlvbiBzdG9yZVwiKVxuXG4gICAgQW5ub3RhdG9yLnNob3dOb3RpZmljYXRpb24gbWVzc2FnZSwgQW5ub3RhdG9yLk5vdGlmaWNhdGlvbi5FUlJPUlxuXG4gICAgY29uc29sZS5lcnJvciBfdChcIkFQSSByZXF1ZXN0IGZhaWxlZDpcIikgKyBcIiAnI3t4aHIuc3RhdHVzfSdcIlxuXG5Bbm5vdGF0b3IuUGx1Z2luLnJlZ2lzdGVyKCdTdG9yZScsIFN0b3JlKVxuXG5tb2R1bGUuZXhwb3J0cyA9IFN0b3JlXG4iXX0=
